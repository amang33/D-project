<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="mapper.cs">
	<!-- 리절트 맵 정의 -->
	<resultMap id="csResult" type="CsVO">
		<result property="notice_id" column="notice_id" />
		<result property="user_id" column="user_id" />
		<result property="notice_category" column="notice_category" />
		<result property="notice_pw" column="notice_pw" />
		<result property="notice_title" column="notice_title" />
		<result property="notice_body" column="notice_body" />
		<result property="notice_cre_date" column="notice_cre_date" />
		<result property="notice_grade" column="notice_grade" />
		<result property="notice_private" column="notice_private" />
		<result property="notice_type" column="notice_type" />
		<result property="order_id" column="order_id" />
		<result property="product_id" column="product_id" />
	</resultMap>

	<select id="QAList" resultMap="csResult" parameterType="CsVO">
		<![CDATA[
		select notice_id, notice_title, notice_body from notice where notice_category='QA'
		order by notice_cre_date desc
		]]>
	</select>

	<select id="questList" resultMap="csResult" parameterType="CsVO">
		<![CDATA[
		select * from notice 
		where notice_category = 'user_quest'
		]]>
	</select>

	<insert id="insertNewQuest" parameterType="CsVO">
		<selectKey resultType="String" keyProperty="notice_id" order="BEFORE">
			<![CDATA[
				select concat('notice_', nextval('notice'))
			]]>
		</selectKey>
      <![CDATA[
      insert into notice (notice_id, 
                        user_id, notice_category, 
                        notice_pw, notice_title, notice_body, 
                        notice_cre_date, notice_private, 
                        notice_type, 
                        notice_match_no, 
                        notice_parent_no)
                  values (#{notice_id}, 
                        #{user_id}, 'user_quest',
                        #{notice_pw}, #{notice_title}, #{notice_body}, 
                        now(), #{notice_private},
                        #{notice_type}, 
                        #{notice_id}, 
                        0)
	]]>
	</insert>
	
	<select id="questDetail" resultType="CsVO" parameterType="String">
		<![CDATA[
			select * from notice where notice_id=#{notice_id}
		]]>
	</select>
	
	<update id="updateQuest" parameterType="java.util.Map">
		<![CDATA[
			update notice set notice_title=#{notice_title}, notice_body=#{notice_body}, 
			notice_cre_date=now() where notice_id=#{notice_id} and user_id=#{user_id}
		]]>
	</update>

</mapper>